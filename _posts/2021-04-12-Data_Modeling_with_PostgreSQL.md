---
title: 'Data Modeling with PostgreSQL'
date: 2021-04-12
header:
#   image: "/images/foo-bar-identity.jpg"
#   caption: "A beautiful photo"
  teaser: "/images/20210412_data_modeling_postgre/python_postgre.jpg"
tags:
  - SQL
  - PostgreSQL
  - Python
# toc: true
# toc_label: "Contents"
# toc_icon: "cog"
classes: wide
---

Summary: Modeling user activity data to create a relational database and ETL pipeline in PostgreSQL for a music streaming app.

Check the code [here](https://github.com/ycheng22/Udacity_Data_Engineer_Nanodegree).

**Contents:**
- [1. Introduction:](#1-introduction)
- [2. Project datasets](#2-project-datasets)
  - [2.1 Song dataset](#21-song-dataset)
  - [2.2 Log dataset](#22-log-dataset)
- [3. Schema for Song Play Data Analysis](#3-schema-for-song-play-data-analysis)
  - [3.1 Fact Table](#31-fact-table)
  - [3.2 Dimension Tables](#32-dimension-tables)

## 1. Introduction: 

Modeling user activity data to create a database and ETL pipeline in Postgres for a music streaming app. Defining fact and dimension tables and insert data into new tables. 

## 2. Project datasets
   
   There are two dataset: song dataset and log dataset. 
```
ðŸ“¦data
 â”£ ðŸ“‚log_data
 â”ƒ â”— ðŸ“‚2018
 â”ƒ â”ƒ â”— ðŸ“‚11
 â”ƒ â”ƒ â”ƒ â”£ ðŸ“œ2018-11-01-events.json
 â”ƒ â”ƒ â”ƒ â”£ ðŸ“œ2018-11-02-events.json
 â”ƒ â”ƒ â”ƒ â”£ ...
 â”— ðŸ“‚song_data
 â”ƒ â”— ðŸ“‚A
 â”ƒ â”ƒ â”£ ðŸ“‚A
 â”ƒ â”ƒ â”ƒ â”£ ðŸ“‚A
 â”ƒ â”ƒ â”ƒ â”ƒ â”£ ðŸ“œTRAAAAW128F429D538.json
 â”ƒ â”ƒ â”ƒ â”ƒ â”£ ðŸ“œTRAAABD128F429CF47.json
 â”ƒ â”ƒ â”ƒ â”ƒ â”£ ...
 â”ƒ â”ƒ â”ƒ â”£ ðŸ“‚B
 â”ƒ â”ƒ â”ƒ â”ƒ â”£ ðŸ“œTRAABCL128F4286650.json
 â”ƒ â”ƒ â”ƒ â”ƒ â”£ ðŸ“œTRAABDL12903CAABBA.json
 â”ƒ â”ƒ â”ƒ â”ƒ â”£ ...
 â”ƒ â”ƒ â”ƒ â”— ðŸ“‚C
 â”ƒ â”ƒ â”ƒ â”ƒ â”£ ðŸ“œTRAACCG128F92E8A55.json
 â”ƒ â”ƒ â”ƒ â”ƒ â”£ ðŸ“œTRAACER128F4290F96.json
 â”ƒ â”ƒ â”ƒ â”ƒ â”£ ðŸ“œTRAACFV128F935E50B.json
 â”ƒ â”ƒ â”ƒ â”ƒ â”£ ...
 â”ƒ â”ƒ â”— ðŸ“‚B
 â”ƒ â”ƒ â”ƒ â”£ ðŸ“‚A
 â”ƒ â”ƒ â”ƒ â”ƒ â”£ ðŸ“œTRABACN128F425B784.json
 â”ƒ â”ƒ â”ƒ â”ƒ â”£ ðŸ“œTRABAFJ128F42AF24E.json
 â”ƒ â”ƒ â”ƒ â”ƒ â”£ ...
 â”ƒ â”ƒ â”ƒ â”£ ðŸ“‚B
 â”ƒ â”ƒ â”ƒ â”ƒ â”£ ðŸ“œTRABBAM128F429D223.json
 â”ƒ â”ƒ â”ƒ â”ƒ â”£ ðŸ“œTRABBBV128F42967D7.json
 â”ƒ â”ƒ â”ƒ â”ƒ â”£ ...
 â”ƒ â”ƒ â”ƒ â”— ðŸ“‚C
 â”ƒ â”ƒ â”ƒ â”ƒ â”£ ðŸ“œTRABCAJ12903CDFCC2.json
 â”ƒ â”ƒ â”ƒ â”ƒ â”£ ðŸ“œTRABCEC128F426456E.json
 â”ƒ â”ƒ â”ƒ â”ƒ â”£ ...
```
### 2.1 Song dataset
  
The first dataset is a subset of real data from the [Million Song Dataset](http://millionsongdataset.com/). Each file is in JSON format and contains metadata about a song and the artist of that song. The files are partitioned by the first three letters of each song's track ID. For example, here are filepaths to two files in this dataset. 
```
song_data/A/B/C/TRABCEI128F424C983.json
song_data/A/A/B/TRAABJL12903CDCF1A.json
```
And below is an example of what a single song file, TRAABJL12903CDCF1A.json, looks like. 

```
{"num_songs": 1, "artist_id": "ARJIE2Y1187B994AB7", "artist_latitude": null, "artist_longitude": null, "artist_location": "", "artist_name": "Line Renaud", "song_id": "SOUPIRU12A6D4FA1E1", "title": "Der Kleine Dompfaff", "duration": 152.92036, "year": 0}
```

### 2.2 Log dataset
  
The second dataset consists of log files in JSON format generated by this [event simulator](https://github.com/Interana/eventsim) based on the songs in the dataset above. These simulate activity logs from a music streaming app based on specified configurations.

The log files in the dataset you'll be working with are partitioned by year and month. For example, here are filepaths to two files in this dataset.

And below is an example of what the data in a log file, 2018-11-12-events.json, looks like. 

<p align="center">
<img src="../images/20210412_data_modeling_postgre/log_data.png"  >
</p>

## 3. Schema for Song Play Data Analysis 
   
Using the song and log datasets, creating a **star schema** optimized for queries on song play analysis. This includes the following tables.

### 3.1 Fact Table

- **songplays**: records in log data associated with song plays 
  
    `songplay_id, start_time, user_id, level, song_id, artist_id, session_id, location, user_agent`

### 3.2 Dimension Tables

- **users**: users in the app
  
    `user_id, first_name, last_name, gender, level`
- **songs**: songs in music database
  
    `song_id, title, artist_id, year, duration`
- **artists**: artists in music database
  
    `artist_id, name, location, latitude, longitude`
- **time**: timestamps of records in **songplays** broken down into specific units
  
    `start_time, hour, day, week, month, year, weekday`

